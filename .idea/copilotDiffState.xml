<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/gg/corn/DunceChat/DunceChat.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/gg/corn/DunceChat/DunceChat.java" />
              <option name="originalContent" value="package gg.corn.DunceChat;&#10;&#10;import java.io.File;&#10;import java.io.IOException;&#10;import java.io.InputStream;&#10;import java.nio.file.Files;&#10;import java.sql.*;&#10;import java.text.SimpleDateFormat;&#10;import java.util.*;&#10;&#10;import org.bukkit.Bukkit;&#10;import org.bukkit.ChatColor;&#10;import org.bukkit.OfflinePlayer;&#10;import org.bukkit.configuration.file.FileConfiguration;&#10;import org.bukkit.configuration.file.YamlConfiguration;&#10;import org.bukkit.entity.Player;&#10;import org.bukkit.event.Listener;&#10;import org.bukkit.plugin.java.JavaPlugin;&#10;&#10;import com.google.common.collect.Sets;&#10;import org.bukkit.scheduler.BukkitScheduler;&#10;import org.bukkit.scheduler.BukkitTask;&#10;import org.jetbrains.annotations.NotNull;&#10;&#10;import static gg.corn.DunceChat.DunceCommand.unduncePlayer;&#10;&#10;public class DunceChat extends JavaPlugin implements Listener {&#10;&#10;    public static DunceChat plugin;&#10;    private NBTHandler nbtHandler;&#10;&#10;&#10;    private FileConfiguration wordsConfig;&#10;&#10;    public void onEnable() {&#10;        plugin = gg.corn.DunceChat.DunceChat.getPlugin(DunceChat.class);&#10;&#10;        getServer().getPluginManager().registerEvents(new Events(), this);&#10;        getServer().getPluginManager().registerEvents(new Greentexter(), this);&#10;&#10;        if (!getDataFolder().exists()) {&#10;            getDataFolder().mkdirs();&#10;        }&#10;&#10;        loadConfig();&#10;        loadWordsConfig();&#10;        setupMySQL();&#10;        createTables();&#10;        scheduleUndunceTask();&#10;&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;dunce&quot;)).setExecutor(new DunceCommand());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;undunce&quot;)).setExecutor(new DunceCommand());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;dc&quot;)).setExecutor(new DunceCommand());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;dcon&quot;)).setExecutor(new DunceToggle());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;dcoff&quot;)).setExecutor(new DunceToggle());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;duncemenu&quot;)).setExecutor(new DunceGUI());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;clearchat&quot;)).setExecutor(new ClearChat());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;duncereload&quot;)).setExecutor(new ReloadCommand());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;duncelookup&quot;)).setExecutor(new DunceLookupCommand());&#10;    }&#10;&#10;    static SimpleDateFormat dateFormatter = new SimpleDateFormat(&quot;yyyy/MM/dd HH:mm&quot;);&#10;&#10;&#10;    private void setupMySQL() {&#10;        String host = getConfig().getString(&quot;mysql.host&quot;);&#10;        int port = getConfig().getInt(&quot;mysql.port&quot;);&#10;        String database = getConfig().getString(&quot;mysql.database&quot;);&#10;        String username = getConfig().getString(&quot;mysql.username&quot;);&#10;        String password = getConfig().getString(&quot;mysql.password&quot;);&#10;&#10;        new MySQLHandler(host, port, database, username, password);&#10;    }&#10;    private void createTables() {&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;CREATE TABLE IF NOT EXISTS dunced_players (&quot; +&#10;                    &quot;uuid VARCHAR(36) PRIMARY KEY,&quot; +&#10;                    &quot;dunced BOOLEAN,&quot; +&#10;                    &quot;reason TEXT,&quot; +&#10;                    &quot;staff_uuid VARCHAR(36),&quot; +&#10;                    &quot;date DATETIME,&quot; +&#10;                    &quot;expiry_date DATETIME&quot; +&#10;                    &quot;);&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.executeUpdate();&#10;&#10;            query = &quot;CREATE TABLE IF NOT EXISTS dunce_visible (&quot; +&#10;                    &quot;uuid VARCHAR(36) PRIMARY KEY,&quot; +&#10;                    &quot;visible BOOLEAN&quot; +&#10;                    &quot;);&quot;;&#10;            preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.executeUpdate();&#10;&#10;            query = &quot;CREATE TABLE IF NOT EXISTS dunce_chat (&quot; +&#10;                    &quot;uuid VARCHAR(36) PRIMARY KEY,&quot; +&#10;                    &quot;in_chat BOOLEAN&quot; +&#10;                    &quot;);&quot;;&#10;            preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.executeUpdate();&#10;            query = &quot;CREATE TABLE IF NOT EXISTS users (&quot; +&#10;                    &quot;uuid VARCHAR(36) PRIMARY KEY,&quot; +&#10;                    &quot;display_name TEXT,&quot; +&#10;                    &quot;last_login DATETIME,&quot; +&#10;                    &quot;last_logout DATETIME&quot; +&#10;                    &quot;);&quot;;&#10;            preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.executeUpdate();&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;    public static Set&lt;String&gt; getDunced() {&#10;        Set&lt;String&gt; duncedSet = Sets.newHashSet();&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT uuid FROM dunced_players WHERE dunced = true&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            while (resultSet.next()) {&#10;                duncedSet.add(resultSet.getString(&quot;uuid&quot;));&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return duncedSet;&#10;    }&#10;&#10;&#10;    public static @NotNull Set&lt;Player&gt; getPlayersDunceChatVisible() {&#10;        Set&lt;Player&gt; players = new HashSet&lt;&gt;();&#10;&#10;        for (Player player : Bukkit.getOnlinePlayers())&#10;            if (dunceVisible(player))&#10;                players.add(player);&#10;&#10;        return players;&#10;    }&#10;&#10;    public static void setDunced(UUID uuid, boolean dunced, String reason, UUID staffUUID, Timestamp expiry) {&#10;&#10;        Set&lt;String&gt; dunceSet = getDunced();&#10;        OfflinePlayer player = plugin.getServer().getOfflinePlayer(uuid);&#10;        Player staff = staffUUID == null ? null : plugin.getServer().getPlayer(staffUUID);&#10;&#10;        setDunceChatVisible(uuid, true);&#10;        setInDunceChat(uuid, true);&#10;&#10;&#10;        if (dunced) {&#10;            dunceSet.add(player.getUniqueId().toString());&#10;&#10;            for (Player online : Bukkit.getOnlinePlayers()) {&#10;                StringBuilder dunceMessage = new StringBuilder();&#10;                dunceMessage.append(&quot;been dunced by &quot;)&#10;                        .append(highlightColor())&#10;                        .append(staff == null ? &quot;CONSOLE&quot; : staff.getName());&#10;&#10;                if (reason != null) {&#10;                    dunceMessage.append(baseColor()).append(&quot; for \&quot;&quot;).append(highlightColor())&#10;                            .append(reason).append(baseColor()).append(&quot;\&quot;&quot;);&#10;                }&#10;&#10;                dunceMessage.append(baseColor()).append(&quot;.&quot;);&#10;&#10;                String message = dunceMessage.toString();&#10;&#10;                StringBuilder finalMessage = new StringBuilder();&#10;&#10;                if (player.getPlayer() != null &amp;&amp; online.equals(player.getPlayer())) {&#10;                    finalMessage.append(baseColor()).append(&quot;You have &quot;).append(message)&#10;                            .append(baseColor())&#10;                            .append(&quot; Only players with Dunce Chat visible can see your messages.&quot;)&#10;                            .append(&quot; Expires on: &quot;)&#10;                            .append(highlightColor())&#10;                            .append(expiry == null ? &quot;never&quot; : dateFormatter.format(expiry));&#10;                } else {&#10;                    finalMessage.append(highlightColor()).append(player.getName())&#10;                            .append(baseColor()).append(&quot; has &quot;).append(message)&#10;                            .append(&quot; You can show the unmoderated chat by using &quot;)&#10;                            .append(highlightColor()).append(&quot;/dcon&quot;).append(baseColor()).append(&quot;.&quot;);&#10;                }&#10;&#10;                online.sendMessage(finalMessage.toString());&#10;            }&#10;        } else {&#10;            dunceSet.remove(player.getUniqueId().toString());&#10;            setInDunceChat(player.getUniqueId(), false);&#10;            for (Player online : Bukkit.getOnlinePlayers()) {&#10;                StringBuilder undunceMessage = new StringBuilder();&#10;                undunceMessage.append(highlightColor());&#10;                undunceMessage.append(staff.getName());&#10;                undunceMessage.append(baseColor());&#10;                undunceMessage.append(&quot; has undunced &quot;);&#10;                undunceMessage.append(highlightColor());&#10;                undunceMessage.append(player.getName());&#10;&#10;                online.sendMessage(undunceMessage.toString());&#10;            }&#10;        }&#10;&#10;        MySQLHandler.addDuncedPlayer(uuid,dunced,reason,staffUUID,expiry);&#10;&#10;    }&#10;&#10;    public static boolean isDunced(@NotNull Player player) {&#10;        return isDunced(player.getUniqueId());&#10;    }&#10;&#10;    public static boolean isDunced(UUID uuid) {&#10;        boolean dunced = false;&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT dunced FROM dunced_players WHERE uuid = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            if (resultSet.next()) {&#10;                dunced = resultSet.getBoolean(&quot;dunced&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return dunced;&#10;    }&#10;&#10;    public static void setDunceChatVisible(@NotNull Player player, boolean visible) {&#10;        setDunceChatVisible(player.getUniqueId(), visible);&#10;    }&#10;&#10;    public static void setDunceChatVisible(UUID uuid, boolean visible) {&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;INSERT INTO dunce_visible (uuid, visible) VALUES (?, ?) ON DUPLICATE KEY UPDATE visible = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            preparedStatement.setBoolean(2, visible);&#10;            preparedStatement.setBoolean(3, visible);&#10;            preparedStatement.executeUpdate();&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public static boolean dunceVisible(@NotNull Player player) {&#10;        return dunceVisible(player.getUniqueId());&#10;    }&#10;&#10;    public static boolean dunceVisible(UUID uuid) {&#10;        boolean visible = plugin.getConfig().getBoolean(&quot;visible-by-default&quot;);&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT visible FROM dunce_visible WHERE uuid = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            if (resultSet.next()) {&#10;                visible = resultSet.getBoolean(&quot;visible&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return visible;&#10;    }&#10;&#10;&#10;    public static void setInDunceChat(@NotNull Player player, boolean value) {&#10;        setInDunceChat(player.getUniqueId(), value);&#10;    }&#10;&#10;    public static void setInDunceChat(UUID uuid, boolean value) {&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;INSERT INTO dunce_chat (uuid, in_chat) VALUES (?, ?) ON DUPLICATE KEY UPDATE in_chat = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            preparedStatement.setBoolean(2, value);&#10;            preparedStatement.setBoolean(3, value);&#10;            preparedStatement.executeUpdate();&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public static boolean getInDunceChat(Player player) {&#10;        boolean inChat = false;&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT in_chat FROM dunce_chat WHERE uuid = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, player.getUniqueId().toString());&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            if (resultSet.next()) {&#10;                inChat = resultSet.getBoolean(&quot;in_chat&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return inChat;&#10;    }&#10;&#10;    public static ChatColor baseColor() {&#10;        try {&#10;            return ChatColor.valueOf(plugin.getConfig().getString(&quot;baseColor&quot;));&#10;        } catch (EnumConstantNotPresentException e) {&#10;            return ChatColor.MAGIC;&#10;        }&#10;    }&#10;&#10;    public static ChatColor highlightColor() {&#10;        try {&#10;            return ChatColor.valueOf(plugin.getConfig().getString(&quot;highlightColor&quot;));&#10;        } catch (EnumConstantNotPresentException e) {&#10;            return ChatColor.MAGIC;&#10;        }&#10;    }&#10;&#10;    public void loadConfig() {&#10;        getConfig().options().copyDefaults(true);&#10;        saveConfig();&#10;    }&#10;&#10;    public void loadWordsConfig() {&#10;        File wordsFile = new File(getDataFolder(), &quot;words.yml&quot;);&#10;        if (!wordsFile.exists()) {&#10;            try (InputStream in = getResource(&quot;words.yml&quot;)) {&#10;                assert in != null;&#10;                Files.copy(in, wordsFile.toPath());&#10;            } catch (IOException e) {&#10;                e.printStackTrace();&#10;            }&#10;        }&#10;        wordsConfig = YamlConfiguration.loadConfiguration(wordsFile);&#10;    }&#10;&#10;    public FileConfiguration getWordsConfig() {&#10;        if (wordsConfig == null) {&#10;            loadWordsConfig();&#10;        }&#10;        return wordsConfig;&#10;    }&#10;&#10;    public static Timestamp getDuncedExpiry(UUID uuid) {&#10;&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT expiry FROM dunced_players WHERE uuid = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            if (resultSet.next()) {&#10;                return resultSet.getTimestamp(&quot;expiry&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return null;&#10;    }&#10;&#10;    private final HashMap&lt;UUID, BukkitTask&gt; dunceTasks = new HashMap&lt;&gt;();&#10;&#10;&#10;    public void scheduleUndunceTask() {&#10;        // Get the Bukkit scheduler&#10;        BukkitScheduler scheduler = getServer().getScheduler();&#10;&#10;&#10;        // Schedule a task to run every second&#10;        scheduler.runTaskTimerAsynchronously(this, () -&gt; {&#10;            // For every dunced player&#10;            for (String uuid : DunceChat.getDunced()) {&#10;                Timestamp expiry = DunceChat.getDuncedExpiry(UUID.fromString(uuid));&#10;                // If the player is dunced and the expiry timestamp is reached&#10;                if (expiry != null &amp;&amp; new Timestamp(System.currentTimeMillis()).after(expiry)) {&#10;                    String player = MySQLHandler.getNameByUUID(UUID.fromString(uuid));&#10;                    // Undunce the player&#10;                    unduncePlayer(player,Bukkit.getConsoleSender());&#10;&#10;                }&#10;            }&#10;        }, 0L, 20L);  // 20 ticks == 1 second&#10;    }&#10;&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package gg.corn.DunceChat;&#10;&#10;import java.io.File;&#10;import java.io.IOException;&#10;import java.io.InputStream;&#10;import java.nio.file.Files;&#10;import java.sql.*;&#10;import java.text.SimpleDateFormat;&#10;import java.util.*;&#10;&#10;import org.bukkit.Bukkit;&#10;import org.bukkit.OfflinePlayer;&#10;import org.bukkit.configuration.file.FileConfiguration;&#10;import org.bukkit.configuration.file.YamlConfiguration;&#10;import org.bukkit.entity.Player;&#10;import org.bukkit.event.Listener;&#10;import org.bukkit.plugin.java.JavaPlugin;&#10;&#10;import net.kyori.adventure.text.Component;&#10;import net.kyori.adventure.text.format.NamedTextColor;&#10;import net.kyori.adventure.text.format.TextColor;&#10;&#10;import com.google.common.collect.Sets;&#10;import org.bukkit.scheduler.BukkitScheduler;&#10;import org.bukkit.scheduler.BukkitTask;&#10;import org.jetbrains.annotations.NotNull;&#10;&#10;import static gg.corn.DunceChat.DunceCommand.unduncePlayer;&#10;&#10;public class DunceChat extends JavaPlugin implements Listener {&#10;&#10;    public static DunceChat plugin;&#10;    private NBTHandler nbtHandler;&#10;&#10;&#10;    private FileConfiguration wordsConfig;&#10;&#10;    public void onEnable() {&#10;        plugin = gg.corn.DunceChat.DunceChat.getPlugin(DunceChat.class);&#10;&#10;        getServer().getPluginManager().registerEvents(new Events(), this);&#10;        getServer().getPluginManager().registerEvents(new Greentexter(), this);&#10;&#10;        if (!getDataFolder().exists()) {&#10;            getDataFolder().mkdirs();&#10;        }&#10;&#10;        loadConfig();&#10;        loadWordsConfig();&#10;        setupMySQL();&#10;        createTables();&#10;        scheduleUndunceTask();&#10;&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;dunce&quot;)).setExecutor(new DunceCommand());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;undunce&quot;)).setExecutor(new DunceCommand());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;dc&quot;)).setExecutor(new DunceCommand());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;dcon&quot;)).setExecutor(new DunceToggle());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;dcoff&quot;)).setExecutor(new DunceToggle());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;duncemenu&quot;)).setExecutor(new DunceGUI());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;clearchat&quot;)).setExecutor(new ClearChat());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;duncereload&quot;)).setExecutor(new ReloadCommand());&#10;        Objects.requireNonNull(getServer().getPluginCommand(&quot;duncelookup&quot;)).setExecutor(new DunceLookupCommand());&#10;    }&#10;&#10;    static SimpleDateFormat dateFormatter = new SimpleDateFormat(&quot;yyyy/MM/dd HH:mm&quot;);&#10;&#10;&#10;    private void setupMySQL() {&#10;        String host = getConfig().getString(&quot;mysql.host&quot;);&#10;        int port = getConfig().getInt(&quot;mysql.port&quot;);&#10;        String database = getConfig().getString(&quot;mysql.database&quot;);&#10;        String username = getConfig().getString(&quot;mysql.username&quot;);&#10;        String password = getConfig().getString(&quot;mysql.password&quot;);&#10;&#10;        new MySQLHandler(host, port, database, username, password);&#10;    }&#10;    private void createTables() {&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;CREATE TABLE IF NOT EXISTS dunced_players (&quot; +&#10;                    &quot;uuid VARCHAR(36) PRIMARY KEY,&quot; +&#10;                    &quot;dunced BOOLEAN,&quot; +&#10;                    &quot;reason TEXT,&quot; +&#10;                    &quot;staff_uuid VARCHAR(36),&quot; +&#10;                    &quot;date DATETIME,&quot; +&#10;                    &quot;expiry_date DATETIME&quot; +&#10;                    &quot;);&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.executeUpdate();&#10;&#10;            query = &quot;CREATE TABLE IF NOT EXISTS dunce_visible (&quot; +&#10;                    &quot;uuid VARCHAR(36) PRIMARY KEY,&quot; +&#10;                    &quot;visible BOOLEAN&quot; +&#10;                    &quot;);&quot;;&#10;            preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.executeUpdate();&#10;&#10;            query = &quot;CREATE TABLE IF NOT EXISTS dunce_chat (&quot; +&#10;                    &quot;uuid VARCHAR(36) PRIMARY KEY,&quot; +&#10;                    &quot;in_chat BOOLEAN&quot; +&#10;                    &quot;);&quot;;&#10;            preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.executeUpdate();&#10;            query = &quot;CREATE TABLE IF NOT EXISTS users (&quot; +&#10;                    &quot;uuid VARCHAR(36) PRIMARY KEY,&quot; +&#10;                    &quot;display_name TEXT,&quot; +&#10;                    &quot;last_login DATETIME,&quot; +&#10;                    &quot;last_logout DATETIME&quot; +&#10;                    &quot;);&quot;;&#10;            preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.executeUpdate();&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;    public static Set&lt;String&gt; getDunced() {&#10;        Set&lt;String&gt; duncedSet = Sets.newHashSet();&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT uuid FROM dunced_players WHERE dunced = true&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            while (resultSet.next()) {&#10;                duncedSet.add(resultSet.getString(&quot;uuid&quot;));&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return duncedSet;&#10;    }&#10;&#10;&#10;    public static @NotNull Set&lt;Player&gt; getPlayersDunceChatVisible() {&#10;        Set&lt;Player&gt; players = new HashSet&lt;&gt;();&#10;&#10;        for (Player player : Bukkit.getOnlinePlayers())&#10;            if (dunceVisible(player))&#10;                players.add(player);&#10;&#10;        return players;&#10;    }&#10;&#10;    public static void setDunced(UUID uuid, boolean dunced, String reason, UUID staffUUID, Timestamp expiry) {&#10;&#10;        Set&lt;String&gt; dunceSet = getDunced();&#10;        OfflinePlayer player = plugin.getServer().getOfflinePlayer(uuid);&#10;        Player staff = staffUUID == null ? null : plugin.getServer().getPlayer(staffUUID);&#10;&#10;        setDunceChatVisible(uuid, true);&#10;        setInDunceChat(uuid, true);&#10;&#10;&#10;        if (dunced) {&#10;            dunceSet.add(player.getUniqueId().toString());&#10;&#10;            for (Player online : Bukkit.getOnlinePlayers()) {&#10;                Component message;&#10;                &#10;                if (player.getPlayer() != null &amp;&amp; online.equals(player.getPlayer())) {&#10;                    message = Component.text(&quot;You have been dunced by &quot;, baseColor())&#10;                            .append(Component.text(staff == null ? &quot;CONSOLE&quot; : staff.getName(), highlightColor()));&#10;                    &#10;                    if (reason != null) {&#10;                        message = message.append(Component.text(&quot; for \&quot;&quot;, baseColor()))&#10;                                .append(Component.text(reason, highlightColor()))&#10;                                .append(Component.text(&quot;\&quot;&quot;, baseColor()));&#10;                    }&#10;                    &#10;                    message = message.append(Component.text(&quot;. Only players with Dunce Chat visible can see your messages. Expires on: &quot;, baseColor()))&#10;                            .append(Component.text(expiry == null ? &quot;never&quot; : dateFormatter.format(expiry), highlightColor()));&#10;                } else {&#10;                    message = Component.text(player.getName(), highlightColor())&#10;                            .append(Component.text(&quot; has been dunced by &quot;, baseColor()))&#10;                            .append(Component.text(staff == null ? &quot;CONSOLE&quot; : staff.getName(), highlightColor()));&#10;                    &#10;                    if (reason != null) {&#10;                        message = message.append(Component.text(&quot; for \&quot;&quot;, baseColor()))&#10;                                .append(Component.text(reason, highlightColor()))&#10;                                .append(Component.text(&quot;\&quot;&quot;, baseColor()));&#10;                    }&#10;                    &#10;                    message = message.append(Component.text(&quot;. You can show the unmoderated chat by using &quot;, baseColor()))&#10;                            .append(Component.text(&quot;/dcon&quot;, highlightColor()))&#10;                            .append(Component.text(&quot;.&quot;, baseColor()));&#10;                }&#10;&#10;                online.sendMessage(message);&#10;            }&#10;        } else {&#10;            dunceSet.remove(player.getUniqueId().toString());&#10;            setInDunceChat(player.getUniqueId(), false);&#10;            for (Player online : Bukkit.getOnlinePlayers()) {&#10;                Component message = Component.text(staff.getName(), highlightColor())&#10;                        .append(Component.text(&quot; has undunced &quot;, baseColor()))&#10;                        .append(Component.text(player.getName(), highlightColor()));&#10;&#10;                online.sendMessage(message);&#10;            }&#10;        }&#10;&#10;        MySQLHandler.addDuncedPlayer(uuid,dunced,reason,staffUUID,expiry);&#10;&#10;    }&#10;&#10;    public static boolean isDunced(@NotNull Player player) {&#10;        return isDunced(player.getUniqueId());&#10;    }&#10;&#10;    public static boolean isDunced(UUID uuid) {&#10;        boolean dunced = false;&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT dunced FROM dunced_players WHERE uuid = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            if (resultSet.next()) {&#10;                dunced = resultSet.getBoolean(&quot;dunced&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return dunced;&#10;    }&#10;&#10;    public static void setDunceChatVisible(@NotNull Player player, boolean visible) {&#10;        setDunceChatVisible(player.getUniqueId(), visible);&#10;    }&#10;&#10;    public static void setDunceChatVisible(UUID uuid, boolean visible) {&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;INSERT INTO dunce_visible (uuid, visible) VALUES (?, ?) ON DUPLICATE KEY UPDATE visible = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            preparedStatement.setBoolean(2, visible);&#10;            preparedStatement.setBoolean(3, visible);&#10;            preparedStatement.executeUpdate();&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public static boolean dunceVisible(@NotNull Player player) {&#10;        return dunceVisible(player.getUniqueId());&#10;    }&#10;&#10;    public static boolean dunceVisible(UUID uuid) {&#10;        boolean visible = plugin.getConfig().getBoolean(&quot;visible-by-default&quot;);&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT visible FROM dunce_visible WHERE uuid = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            if (resultSet.next()) {&#10;                visible = resultSet.getBoolean(&quot;visible&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return visible;&#10;    }&#10;&#10;&#10;    public static void setInDunceChat(@NotNull Player player, boolean value) {&#10;        setInDunceChat(player.getUniqueId(), value);&#10;    }&#10;&#10;    public static void setInDunceChat(UUID uuid, boolean value) {&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;INSERT INTO dunce_chat (uuid, in_chat) VALUES (?, ?) ON DUPLICATE KEY UPDATE in_chat = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            preparedStatement.setBoolean(2, value);&#10;            preparedStatement.setBoolean(3, value);&#10;            preparedStatement.executeUpdate();&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public static boolean getInDunceChat(Player player) {&#10;        boolean inChat = false;&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT in_chat FROM dunce_chat WHERE uuid = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, player.getUniqueId().toString());&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            if (resultSet.next()) {&#10;                inChat = resultSet.getBoolean(&quot;in_chat&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return inChat;&#10;    }&#10;&#10;    public static TextColor baseColor() {&#10;        try {&#10;            String colorName = plugin.getConfig().getString(&quot;baseColor&quot;);&#10;            return NamedTextColor.NAMES.value(colorName.toLowerCase());&#10;        } catch (Exception e) {&#10;            return NamedTextColor.GRAY;&#10;        }&#10;    }&#10;&#10;    public static TextColor highlightColor() {&#10;        try {&#10;            String colorName = plugin.getConfig().getString(&quot;highlightColor&quot;);&#10;            return NamedTextColor.NAMES.value(colorName.toLowerCase());&#10;        } catch (Exception e) {&#10;            return NamedTextColor.GOLD;&#10;        }&#10;    }&#10;&#10;    public void loadConfig() {&#10;        getConfig().options().copyDefaults(true);&#10;        saveConfig();&#10;    }&#10;&#10;    public void loadWordsConfig() {&#10;        File wordsFile = new File(getDataFolder(), &quot;words.yml&quot;);&#10;        if (!wordsFile.exists()) {&#10;            try (InputStream in = getResource(&quot;words.yml&quot;)) {&#10;                assert in != null;&#10;                Files.copy(in, wordsFile.toPath());&#10;            } catch (IOException e) {&#10;                e.printStackTrace();&#10;            }&#10;        }&#10;        wordsConfig = YamlConfiguration.loadConfiguration(wordsFile);&#10;    }&#10;&#10;    public FileConfiguration getWordsConfig() {&#10;        if (wordsConfig == null) {&#10;            loadWordsConfig();&#10;        }&#10;        return wordsConfig;&#10;    }&#10;&#10;    public static Timestamp getDuncedExpiry(UUID uuid) {&#10;&#10;        try (Connection connection = MySQLHandler.getConnection()) {&#10;            String query = &quot;SELECT expiry FROM dunced_players WHERE uuid = ?&quot;;&#10;            PreparedStatement preparedStatement = connection.prepareStatement(query);&#10;            preparedStatement.setString(1, uuid.toString());&#10;            ResultSet resultSet = preparedStatement.executeQuery();&#10;            if (resultSet.next()) {&#10;                return resultSet.getTimestamp(&quot;expiry&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return null;&#10;    }&#10;&#10;    private final HashMap&lt;UUID, BukkitTask&gt; dunceTasks = new HashMap&lt;&gt;();&#10;&#10;&#10;    public void scheduleUndunceTask() {&#10;        // Get the Bukkit scheduler&#10;        BukkitScheduler scheduler = getServer().getScheduler();&#10;&#10;&#10;        // Schedule a task to run every second&#10;        scheduler.runTaskTimerAsynchronously(this, () -&gt; {&#10;            // For every dunced player&#10;            for (String uuid : DunceChat.getDunced()) {&#10;                Timestamp expiry = DunceChat.getDuncedExpiry(UUID.fromString(uuid));&#10;                // If the player is dunced and the expiry timestamp is reached&#10;                if (expiry != null &amp;&amp; new Timestamp(System.currentTimeMillis()).after(expiry)) {&#10;                    String player = MySQLHandler.getNameByUUID(UUID.fromString(uuid));&#10;                    // Undunce the player&#10;                    unduncePlayer(player,Bukkit.getConsoleSender());&#10;&#10;                }&#10;            }&#10;        }, 0L, 20L);  // 20 ticks == 1 second&#10;    }&#10;&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/gg/corn/DunceChat/DunceCommand.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/gg/corn/DunceChat/DunceCommand.java" />
              <option name="originalContent" value="package gg.corn.DunceChat;&#10;&#10;import com.google.common.collect.Lists;&#10;import org.bukkit.Bukkit;&#10;import org.bukkit.ChatColor;&#10;&#10;import org.bukkit.command.Command;&#10;import org.bukkit.command.CommandExecutor;&#10;import org.bukkit.command.CommandSender;&#10;import org.bukkit.command.TabCompleter;&#10;import org.bukkit.entity.Player;&#10;&#10;import org.jetbrains.annotations.NotNull;&#10;&#10;import java.sql.Timestamp;&#10;import java.util.*;&#10;&#10;import static gg.corn.DunceChat.DunceChat.baseColor;&#10;import static gg.corn.DunceChat.DunceChat.highlightColor;&#10;import static gg.corn.DunceChat.DunceGUI.constructDunceGUI;&#10;&#10;&#10;public class DunceCommand implements CommandExecutor, TabCompleter {&#10;&#10;&#9;public static DunceChat plugin = gg.corn.DunceChat.DunceChat.getPlugin(DunceChat.class);&#10;&#9;private NBTHandler nbtHandler;&#10;&#10;&#9;@Override&#10;&#9;public boolean onCommand(@NotNull CommandSender sender, @NotNull Command command, @NotNull String label,&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9; @NotNull String[] args) {&#10;&#10;&#9;&#9;if (label.equalsIgnoreCase(&quot;dunce&quot;)) {&#10;&#9;&#9;&#9;if (args.length &gt;= 1 &amp;&amp; sender.hasPermission(&quot;duncechat.admin&quot;))&#10;&#9;&#9;&#9;&#9;tryDunce(args[0], args, sender);&#10;&#9;&#9;&#9;else if (args.length == 0 &amp;&amp; sender.hasPermission(&quot;duncechat.admin&quot;)){&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;DunceChat Commands:&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/dunce &lt;player&gt; &lt;duration&gt; &lt;reason&gt;&quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+&#9;baseColor() + &quot;- Dunce a player. Duration and Reason are optional.&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/undunce &lt;player&gt;&quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+&#9;baseColor() + &quot;- Undunce a player.&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/clearchat&quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+&#9;baseColor() + &quot;- Clear the chat.&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/dcon &quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+ baseColor() + &quot;- Show the Dunce Chat.&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/dcoff &quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+ baseColor() + &quot;- Hide the Dunce Chat.&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/duncemenu &quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+&#9;baseColor() + &quot;- Open the DunceChat Menu.&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/duncelookup&quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+&#9;baseColor() + &quot;- Look up dunce information.&quot;);&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else {&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;DunceChat Commands:&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/dcon &quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+ baseColor() + &quot;- Show the Dunce Chat&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/dcoff &quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+ baseColor() + &quot;- Hide the Dunce Chat&quot;);&#10;&#9;&#9;&#9;&#9;sender.sendMessage(highlightColor() + &quot;/duncemenu &quot;&#10;&#9;&#9;&#9;&#9;&#9;&#9;+ baseColor() + &quot;- Open the DunceChat Menu&quot;);&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;}&#10;&#10;&#9;&#9;else if (label.equalsIgnoreCase(&quot;dc&quot;)) {&#10;&#9;&#9;&#9;if (sender instanceof Player player) {&#10;&#10;&#9;&#9;&#9;&#9;if (args.length == 0)&#10;&#9;&#9;&#9;&#9;&#9;constructDunceGUI((Player) sender);&#10;&#9;&#9;&#9;&#9;else {&#10;&#9;&#9;&#9;&#9;&#9;boolean inDunceChat = gg.corn.DunceChat.DunceChat.getInDunceChat(player);&#10;&#10;&#9;&#9;&#9;&#9;&#9;if (!inDunceChat)&#10;&#9;&#9;&#9;&#9;&#9;&#9;gg.corn.DunceChat.DunceChat.setInDunceChat(player, true);&#10;&#10;&#9;&#9;&#9;&#9;&#9;((Player) sender).chat(concat(args));&#10;&#10;&#9;&#9;&#9;&#9;&#9;if (!inDunceChat)&#10;&#9;&#9;&#9;&#9;&#9;&#9;gg.corn.DunceChat.DunceChat.setInDunceChat(player, false);&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;}&#10;&#9;&#9;else if (label.equalsIgnoreCase(&quot;undunce&quot;)) {&#10;&#9;&#9;&#9;if (args.length &gt;= 1 &amp;&amp; sender.hasPermission(&quot;duncechat.admin&quot;))&#10;&#9;&#9;&#9;&#9;unduncePlayer(args[0], sender);&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;&#9;sender.sendMessage(ChatColor.RED+&quot;Insufficient Permissions!&quot;);&#10;&#9;&#9;}&#10;&#10;&#9;&#9;return true;&#10;&#9;}&#10;&#10;&#10;&#9;@Override&#10;&#9;public List&lt;String&gt; onTabComplete(CommandSender sender, @NotNull Command cmd, @NotNull String label, String[] args) {&#10;&#9;&#9;List&lt;String&gt; list = new ArrayList&lt;&gt;();&#10;&#10;&#9;&#9;if (sender.hasPermission(&quot;duncechat.admin&quot;)) {&#10;&#9;&#9;&#9;if (cmd.getName().equalsIgnoreCase(&quot;dunce&quot;) &amp;&amp; args.length == 1) {&#10;&#9;&#9;&#9;&#9;for (Player player : Bukkit.getOnlinePlayers())&#10;&#9;&#9;&#9;&#9;&#9;if (!player.hasPermission(&quot;duncechat.admin&quot;) &amp;&amp; player.getName().toLowerCase().startsWith(args[0]))&#10;&#9;&#9;&#9;&#9;&#9;&#9;list.add(player.getName());&#10;&#10;&#9;&#9;&#9;&#9;Collections.sort(list);&#10;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else if (cmd.getName().equalsIgnoreCase(&quot;dunce&quot;) &amp;&amp; args.length == 2&#10;&#9;&#9;&#9;&#9;&#9;&amp;&amp; plugin.getServer().getPlayer(args[0]) != null) {&#10;&#9;&#9;&#9;&#9;list.addAll(Lists.newArrayList(&quot;1s&quot;, &quot;1m&quot;, &quot;1h&quot;, &quot;1d&quot;, &quot;1w&quot;));&#10;&#9;&#9;&#9;&#9;Collections.sort(list);&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else if (cmd.getName().equalsIgnoreCase(&quot;dunce&quot;) &amp;&amp; args.length == 3&#10;&#9;&#9;&#9;&#9;&#9;&amp;&amp; plugin.getServer().getPlayer(args[0]) != null) {&#10;&#9;&#9;&#9;&#9;list.addAll(Lists.newArrayList(&quot;Racism/Nazism/Hate Speech&quot;, &quot;Spam&quot;, &quot;Blockgame Lawyer&quot;));&#10;&#9;&#9;&#9;&#9;Collections.sort(list);&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else if (sender.hasPermission(&quot;duncechat.admin&quot;)) {&#10;&#9;&#9;&#9;&#9;if (cmd.getName().equalsIgnoreCase(&quot;undunce&quot;) &amp;&amp; args.length == 1) {&#10;&#9;&#9;&#9;&#9;&#9;for (Player player : Bukkit.getOnlinePlayers())&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (!player.hasPermission(&quot;duncechat.admin&quot;) &amp;&amp; player.getName().toLowerCase().startsWith(args[0]))&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;list.add(player.getName());&#10;&#10;&#9;&#9;&#9;&#9;&#9;Collections.sort(list);&#10;&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;}&#10;&#10;&#9;&#9;return list;&#10;&#9;}&#10;&#10;&#9;public static void tryDunce(String name, String[] args, CommandSender sender) {&#10;&#9;&#9;UUID uuid = MySQLHandler.getUUIDByName(name);&#10;&#9;&#9;UUID staff = sender instanceof Player ? ((Player) sender).getUniqueId() : null;&#10;&#9;&#9;StringBuilder reason;&#10;&#9;&#9;Timestamp expiry = null; // Default to null&#10;&#10;&#9;&#9;int reasonStartIndex = 1;&#10;&#9;&#9;boolean durationProvided = args.length &gt;= 2 &amp;&amp; (args[1].endsWith(&quot;s&quot;) || args[1].endsWith(&quot;m&quot;) || args[1].endsWith(&quot;h&quot;) ||&#10;&#9;&#9;&#9;&#9;args[1].endsWith(&quot;d&quot;) || args[1].endsWith(&quot;w&quot;)) &amp;&amp; Character.isDigit(args[1].charAt(0));&#10;&#10;&#9;&#9;// Check if a duration was provided&#10;&#9;&#9;if (durationProvided) {&#10;&#9;&#9;&#9;String duration = args[1];&#10;&#9;&#9;&#9;reasonStartIndex = 2;&#10;&#10;&#9;&#9;&#9;long durationInSeconds = 0;&#10;&#10;&#9;&#9;&#9;if (duration.endsWith(&quot;s&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1));&#10;&#9;&#9;&#9;} else if (duration.endsWith(&quot;m&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1)) * 60;&#10;&#9;&#9;&#9;} else if (duration.endsWith(&quot;h&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1)) * 3600;&#10;&#9;&#9;&#9;} else if (duration.endsWith(&quot;d&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1)) * 86400;&#10;&#9;&#9;&#9;} else if (duration.endsWith(&quot;w&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1)) * 604800;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;// Create a Calendar object with the current date and time&#10;&#9;&#9;&#9;Calendar calendar = Calendar.getInstance();&#10;&#10;&#9;&#9;&#9;// Add the duration to the calendar&#10;&#9;&#9;&#9;calendar.add(Calendar.SECOND, (int) durationInSeconds);&#10;&#10;&#9;&#9;&#9;// Create a Timestamp object with the time in the future&#10;&#9;&#9;&#9;expiry = new Timestamp(calendar.getTimeInMillis());&#10;&#9;&#9;} else {&#10;&#9;&#9;&#9;// If the second argument is not a duration, it is part of the reason&#10;&#9;&#9;&#9;reasonStartIndex = 1;&#10;&#9;&#9;}&#10;&#10;&#9;&#9;reason = new StringBuilder();&#10;&#9;&#9;for (int i = reasonStartIndex; i &lt; args.length; i++)&#10;&#9;&#9;&#9;reason.append(&quot; &quot;).append(args[i]);&#10;&#10;&#9;&#9;reason = new StringBuilder(reason.toString().trim());&#10;&#10;&#10;&#10;&#9;&#9;if (uuid == null)&#10;&#9;&#9;&#9;sender.sendMessage(ChatColor.RED + name&#10;&#9;&#9;&#9;&#9;&#9;+ &quot; has never played here before, or has changed their name since their last login. Check namemc.com if you believe their name has changed.&quot;);&#10;&#9;&#9;else if (plugin.getServer().getPlayer(uuid) != null&#10;&#9;&#9;&#9;&#9;&amp;&amp; Objects.requireNonNull(plugin.getServer().getPlayer(uuid)).hasPermission(&quot;duncechat.admin&quot;))&#10;&#9;&#9;&#9;sender.sendMessage(ChatColor.RED + &quot;That player cannot be dunced.&quot;);&#10;&#9;&#9;else&#10;&#10;&#9;&#9;if (gg.corn.DunceChat.DunceChat.isDunced(uuid)) {&#10;&#9;&#9;&#9;sender.sendMessage(ChatColor.RED + &quot;Target is already dunced! Use /undunce &lt;player&gt; to undunce a player.&quot;);&#10;&#9;&#9;} else if (!reason.isEmpty()) {&#10;&#9;&#9;&#9;DunceChat.setDunced(uuid, true, String.valueOf(reason), staff, expiry);&#10;&#9;&#9;} else {&#10;&#9;&#9;&#9;DunceChat.setDunced(uuid, true, null, staff, expiry);&#10;&#9;&#9;}&#10;&#9;}&#10;&#10;&#9;public static void unduncePlayer(String name, CommandSender sender){&#10;&#9;&#9;UUID uuid = MySQLHandler.getUUIDByName(name);&#10;&#9;&#9;UUID staff = sender instanceof Player ? ((Player) sender).getUniqueId() : null;&#10;&#10;&#9;&#9;if (!gg.corn.DunceChat.DunceChat.isDunced(uuid)) {&#10;&#9;&#9;&#9;sender.sendMessage(ChatColor.RED + &quot;That player is not dunced!&quot;);&#10;&#9;&#9;} else&#10;&#9;&#9;&#9;gg.corn.DunceChat.DunceChat.setDunced(uuid, false, null, staff, null);&#10;&#10;&#9;}&#10;&#10;&#9;public static String concat(String[] args) {&#10;&#9;&#9;StringBuilder string = new StringBuilder();&#10;&#10;&#9;&#9;for (String stringg : args)&#10;&#9;&#9;&#9;string.append(stringg).append(&quot; &quot;);&#10;&#10;&#9;&#9;return string.toString().trim();&#10;&#9;}&#10;}" />
              <option name="updatedContent" value="package gg.corn.DunceChat;&#10;&#10;import com.google.common.collect.Lists;&#10;import org.bukkit.Bukkit;&#10;&#10;import net.kyori.adventure.text.Component;&#10;import net.kyori.adventure.text.format.NamedTextColor;&#10;&#10;import org.bukkit.command.Command;&#10;import org.bukkit.command.CommandExecutor;&#10;import org.bukkit.command.CommandSender;&#10;import org.bukkit.command.TabCompleter;&#10;import org.bukkit.entity.Player;&#10;&#10;import org.jetbrains.annotations.NotNull;&#10;&#10;import java.sql.Timestamp;&#10;import java.util.*;&#10;&#10;import static gg.corn.DunceChat.DunceChat.baseColor;&#10;import static gg.corn.DunceChat.DunceChat.highlightColor;&#10;import static gg.corn.DunceChat.DunceGUI.constructDunceGUI;&#10;&#10;&#10;public class DunceCommand implements CommandExecutor, TabCompleter {&#10;&#10;&#9;public static DunceChat plugin = gg.corn.DunceChat.DunceChat.getPlugin(DunceChat.class);&#10;&#9;private NBTHandler nbtHandler;&#10;&#10;&#9;@Override&#10;&#9;public boolean onCommand(@NotNull CommandSender sender, @NotNull Command command, @NotNull String label,&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9; @NotNull String[] args) {&#10;&#10;&#9;&#9;if (label.equalsIgnoreCase(&quot;dunce&quot;)) {&#10;&#9;&#9;&#9;if (args.length &gt;= 1 &amp;&amp; sender.hasPermission(&quot;duncechat.admin&quot;))&#10;&#9;&#9;&#9;&#9;tryDunce(args[0], args, sender);&#10;&#9;&#9;&#9;else if (args.length == 0 &amp;&amp; sender.hasPermission(&quot;duncechat.admin&quot;)){&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;DunceChat Commands:&quot;, highlightColor()));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/dunce &lt;player&gt; &lt;duration&gt; &lt;reason&gt;&quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Dunce a player. Duration and Reason are optional.&quot;, baseColor())));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/undunce &lt;player&gt;&quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Undunce a player.&quot;, baseColor())));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/clearchat&quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Clear the chat.&quot;, baseColor())));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/dcon &quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Show the Dunce Chat.&quot;, baseColor())));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/dcoff &quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Hide the Dunce Chat.&quot;, baseColor())));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/duncemenu &quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Open the DunceChat Menu.&quot;, baseColor())));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/duncelookup&quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Look up dunce information.&quot;, baseColor())));&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else {&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;DunceChat Commands:&quot;, highlightColor()));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/dcon &quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Show the Dunce Chat&quot;, baseColor())));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/dcoff &quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Hide the Dunce Chat&quot;, baseColor())));&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;/duncemenu &quot;, highlightColor())&#10;&#9;&#9;&#9;&#9;&#9;&#9;.append(Component.text(&quot;- Open the DunceChat Menu&quot;, baseColor())));&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;}&#10;&#10;&#9;&#9;else if (label.equalsIgnoreCase(&quot;dc&quot;)) {&#10;&#9;&#9;&#9;if (sender instanceof Player player) {&#10;&#10;&#9;&#9;&#9;&#9;if (args.length == 0)&#10;&#9;&#9;&#9;&#9;&#9;constructDunceGUI((Player) sender);&#10;&#9;&#9;&#9;&#9;else {&#10;&#9;&#9;&#9;&#9;&#9;boolean inDunceChat = gg.corn.DunceChat.DunceChat.getInDunceChat(player);&#10;&#10;&#9;&#9;&#9;&#9;&#9;if (!inDunceChat)&#10;&#9;&#9;&#9;&#9;&#9;&#9;gg.corn.DunceChat.DunceChat.setInDunceChat(player, true);&#10;&#10;&#9;&#9;&#9;&#9;&#9;((Player) sender).chat(concat(args));&#10;&#10;&#9;&#9;&#9;&#9;&#9;if (!inDunceChat)&#10;&#9;&#9;&#9;&#9;&#9;&#9;gg.corn.DunceChat.DunceChat.setInDunceChat(player, false);&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;}&#10;&#9;&#9;else if (label.equalsIgnoreCase(&quot;undunce&quot;)) {&#10;&#9;&#9;&#9;if (args.length &gt;= 1 &amp;&amp; sender.hasPermission(&quot;duncechat.admin&quot;))&#10;&#9;&#9;&#9;&#9;unduncePlayer(args[0], sender);&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;Insufficient Permissions!&quot;, NamedTextColor.RED));&#10;&#9;&#9;}&#10;&#10;&#9;&#9;return true;&#10;&#9;}&#10;&#10;&#10;&#9;@Override&#10;&#9;public List&lt;String&gt; onTabComplete(CommandSender sender, @NotNull Command cmd, @NotNull String label, String[] args) {&#10;&#9;&#9;List&lt;String&gt; list = new ArrayList&lt;&gt;();&#10;&#10;&#9;&#9;if (sender.hasPermission(&quot;duncechat.admin&quot;)) {&#10;&#9;&#9;&#9;if (cmd.getName().equalsIgnoreCase(&quot;dunce&quot;) &amp;&amp; args.length == 1) {&#10;&#9;&#9;&#9;&#9;for (Player player : Bukkit.getOnlinePlayers())&#10;&#9;&#9;&#9;&#9;&#9;if (!player.hasPermission(&quot;duncechat.admin&quot;) &amp;&amp; player.getName().toLowerCase().startsWith(args[0]))&#10;&#9;&#9;&#9;&#9;&#9;&#9;list.add(player.getName());&#10;&#10;&#9;&#9;&#9;&#9;Collections.sort(list);&#10;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else if (cmd.getName().equalsIgnoreCase(&quot;dunce&quot;) &amp;&amp; args.length == 2&#10;&#9;&#9;&#9;&#9;&#9;&amp;&amp; plugin.getServer().getPlayer(args[0]) != null) {&#10;&#9;&#9;&#9;&#9;list.addAll(Lists.newArrayList(&quot;1s&quot;, &quot;1m&quot;, &quot;1h&quot;, &quot;1d&quot;, &quot;1w&quot;));&#10;&#9;&#9;&#9;&#9;Collections.sort(list);&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else if (cmd.getName().equalsIgnoreCase(&quot;dunce&quot;) &amp;&amp; args.length == 3&#10;&#9;&#9;&#9;&#9;&#9;&amp;&amp; plugin.getServer().getPlayer(args[0]) != null) {&#10;&#9;&#9;&#9;&#9;list.addAll(Lists.newArrayList(&quot;Racism/Nazism/Hate Speech&quot;, &quot;Spam&quot;, &quot;Blockgame Lawyer&quot;));&#10;&#9;&#9;&#9;&#9;Collections.sort(list);&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else if (sender.hasPermission(&quot;duncechat.admin&quot;)) {&#10;&#9;&#9;&#9;&#9;if (cmd.getName().equalsIgnoreCase(&quot;undunce&quot;) &amp;&amp; args.length == 1) {&#10;&#9;&#9;&#9;&#9;&#9;for (Player player : Bukkit.getOnlinePlayers())&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (!player.hasPermission(&quot;duncechat.admin&quot;) &amp;&amp; player.getName().toLowerCase().startsWith(args[0]))&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;list.add(player.getName());&#10;&#10;&#9;&#9;&#9;&#9;&#9;Collections.sort(list);&#10;&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;}&#10;&#10;&#9;&#9;return list;&#10;&#9;}&#10;&#10;&#9;public static void tryDunce(String name, String[] args, CommandSender sender) {&#10;&#9;&#9;UUID uuid = MySQLHandler.getUUIDByName(name);&#10;&#9;&#9;UUID staff = sender instanceof Player ? ((Player) sender).getUniqueId() : null;&#10;&#9;&#9;StringBuilder reason;&#10;&#9;&#9;Timestamp expiry = null; // Default to null&#10;&#10;&#9;&#9;int reasonStartIndex = 1;&#10;&#9;&#9;boolean durationProvided = args.length &gt;= 2 &amp;&amp; (args[1].endsWith(&quot;s&quot;) || args[1].endsWith(&quot;m&quot;) || args[1].endsWith(&quot;h&quot;) ||&#10;&#9;&#9;&#9;&#9;args[1].endsWith(&quot;d&quot;) || args[1].endsWith(&quot;w&quot;)) &amp;&amp; Character.isDigit(args[1].charAt(0));&#10;&#10;&#9;&#9;// Check if a duration was provided&#10;&#9;&#9;if (durationProvided) {&#10;&#9;&#9;&#9;String duration = args[1];&#10;&#9;&#9;&#9;reasonStartIndex = 2;&#10;&#10;&#9;&#9;&#9;long durationInSeconds = 0;&#10;&#10;&#9;&#9;&#9;if (duration.endsWith(&quot;s&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1));&#10;&#9;&#9;&#9;} else if (duration.endsWith(&quot;m&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1)) * 60;&#10;&#9;&#9;&#9;} else if (duration.endsWith(&quot;h&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1)) * 3600;&#10;&#9;&#9;&#9;} else if (duration.endsWith(&quot;d&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1)) * 86400;&#10;&#9;&#9;&#9;} else if (duration.endsWith(&quot;w&quot;)) {&#10;&#9;&#9;&#9;&#9;durationInSeconds = Long.parseLong(duration.substring(0, duration.length() - 1)) * 604800;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;// Create a Calendar object with the current date and time&#10;&#9;&#9;&#9;Calendar calendar = Calendar.getInstance();&#10;&#10;&#9;&#9;&#9;// Add the duration to the calendar&#10;&#9;&#9;&#9;calendar.add(Calendar.SECOND, (int) durationInSeconds);&#10;&#10;&#9;&#9;&#9;// Create a Timestamp object with the time in the future&#10;&#9;&#9;&#9;expiry = new Timestamp(calendar.getTimeInMillis());&#10;&#9;&#9;} else {&#10;&#9;&#9;&#9;// If the second argument is not a duration, it is part of the reason&#10;&#9;&#9;&#9;reasonStartIndex = 1;&#10;&#9;&#9;}&#10;&#10;&#9;&#9;reason = new StringBuilder();&#10;&#9;&#9;for (int i = reasonStartIndex; i &lt; args.length; i++)&#10;&#9;&#9;&#9;reason.append(&quot; &quot;).append(args[i]);&#10;&#10;&#9;&#9;reason = new StringBuilder(reason.toString().trim());&#10;&#10;&#10;&#10;&#9;&#9;if (uuid == null)&#10;&#9;&#9;&#9;sender.sendMessage(Component.text(name + &quot; has never played here before, or has changed their name since their last login. Check namemc.com if you believe their name has changed.&quot;, NamedTextColor.RED));&#10;&#9;&#9;else if (plugin.getServer().getPlayer(uuid) != null&#10;&#9;&#9;&#9;&#9;&amp;&amp; Objects.requireNonNull(plugin.getServer().getPlayer(uuid)).hasPermission(&quot;duncechat.admin&quot;))&#10;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;That player cannot be dunced.&quot;, NamedTextColor.RED));&#10;&#9;&#9;else&#10;&#10;&#9;&#9;if (gg.corn.DunceChat.DunceChat.isDunced(uuid)) {&#10;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;Target is already dunced! Use /undunce &lt;player&gt; to undunce a player.&quot;, NamedTextColor.RED));&#10;&#9;&#9;} else if (!reason.isEmpty()) {&#10;&#9;&#9;&#9;DunceChat.setDunced(uuid, true, String.valueOf(reason), staff, expiry);&#10;&#9;&#9;} else {&#10;&#9;&#9;&#9;DunceChat.setDunced(uuid, true, null, staff, expiry);&#10;&#9;&#9;}&#10;&#9;}&#10;&#10;&#9;public static void unduncePlayer(String name, CommandSender sender){&#10;&#9;&#9;UUID uuid = MySQLHandler.getUUIDByName(name);&#10;&#9;&#9;UUID staff = sender instanceof Player ? ((Player) sender).getUniqueId() : null;&#10;&#10;&#9;&#9;if (!gg.corn.DunceChat.DunceChat.isDunced(uuid)) {&#10;&#9;&#9;&#9;sender.sendMessage(Component.text(&quot;That player is not dunced!&quot;, NamedTextColor.RED));&#10;&#9;&#9;} else&#10;&#9;&#9;&#9;gg.corn.DunceChat.DunceChat.setDunced(uuid, false, null, staff, null);&#10;&#10;&#9;}&#10;&#10;&#9;public static String concat(String[] args) {&#10;&#9;&#9;StringBuilder string = new StringBuilder();&#10;&#10;&#9;&#9;for (String stringg : args)&#10;&#9;&#9;&#9;string.append(stringg).append(&quot; &quot;);&#10;&#10;&#9;&#9;return string.toString().trim();&#10;&#9;}&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/gg/corn/DunceChat/Events.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/gg/corn/DunceChat/Events.java" />
              <option name="originalContent" value="package gg.corn.DunceChat;&#10;&#10;import java.util.*;&#10;import java.util.logging.Logger;&#10;&#10;import com.google.common.collect.Lists;&#10;import com.google.common.collect.Sets;&#10;import org.apache.commons.lang3.StringUtils;&#10;import org.bukkit.Bukkit;&#10;import org.bukkit.ChatColor;&#10;import org.bukkit.NamespacedKey;&#10;import org.bukkit.Sound;&#10;&#10;import org.bukkit.command.ConsoleCommandSender;&#10;import org.bukkit.entity.Player;&#10;import org.bukkit.event.EventHandler;&#10;import org.bukkit.event.Listener;&#10;import org.bukkit.event.inventory.InventoryClickEvent;&#10;import org.bukkit.event.player.AsyncPlayerChatEvent;&#10;import org.bukkit.event.player.PlayerCommandPreprocessEvent;&#10;import org.bukkit.event.player.PlayerJoinEvent;&#10;import org.bukkit.event.player.PlayerQuitEvent;&#10;import org.bukkit.inventory.ItemStack;&#10;import org.bukkit.plugin.Plugin;&#10;import org.jetbrains.annotations.NotNull;&#10;import me.clip.placeholderapi.PlaceholderAPI;&#10;&#10;&#10;public class Events implements Listener {&#10;&#10;    private NBTHandler nbtHandler;&#10;    public static DunceChat plugin = gg.corn.DunceChat.DunceChat.getPlugin(DunceChat.class);&#10;    private static final Logger logger = Bukkit.getLogger();&#10;    public static MySQLHandler mySQLHandler;&#10;    private List&lt;String&gt; disallowedWords;&#10;    NamespacedKey dunceVisibility = new NamespacedKey(plugin, &quot;dunce-visibility&quot;);&#10;    NamespacedKey talkingInDunceChat = new NamespacedKey(plugin, &quot;talking-in-dunce-chat&quot;);&#10;    NamespacedKey page = new NamespacedKey(plugin, &quot;page&quot;);&#10;&#10;    public Events() {&#10;        loadDisallowedWords();&#10;    }&#10;&#10;&#10;    @EventHandler&#10;    public void processCommand(@NotNull PlayerCommandPreprocessEvent event) {&#10;        if (!event.getMessage().contains(&quot; &quot;) || !gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer()))&#10;            return;&#10;&#10;        List&lt;String&gt; list = Lists.newArrayList(&quot;whisper&quot;, &quot;w&quot;, &quot;msg&quot;, &quot;r&quot;, &quot;reply&quot;);&#10;        String message = event.getMessage();&#10;        String command = message.substring(1, message.contains(&quot; &quot;) ? message.indexOf(&quot; &quot;) : message.length())&#10;                .toLowerCase();&#10;        String recipient = message.substring(message.indexOf(&quot; &quot;) + 1, StringUtils.ordinalIndexOf(message, &quot; &quot;, 2) != -1&#10;                ? StringUtils.ordinalIndexOf(message, &quot; &quot;, 2) : message.length() - 1);&#10;        UUID uuid = mySQLHandler.getUUIDByName(recipient);&#10;&#10;        if (list.contains(command) &amp;&amp; uuid != null &amp;&amp; !gg.corn.DunceChat.DunceChat.dunceVisible(uuid)) {&#10;            event.getPlayer().sendMessage(gg.corn.DunceChat.DunceChat.baseColor()&#10;                    + &quot;You have been dunced, and the player you're trying to message has unmoderated chat disabled.&quot;);&#10;            event.setCancelled(true);&#10;        }&#10;    }&#10;&#10;    @EventHandler&#10;    public void clickDunceMenu(@NotNull InventoryClickEvent event) {&#10;&#10;        if (event.getView().getTitle().equals(&quot;DunceChat Menu&quot;) &amp;&amp; event.getView().getTopInventory().getHolder() == null) {&#10;            event.setCancelled(true);&#10;&#10;            if (event.getCurrentItem() == null)&#10;                return;&#10;&#10;            ItemStack item = event.getCurrentItem();&#10;            Player player = (Player) event.getWhoClicked();&#10;&#10;            if (NBTHandler.hasString(item, dunceVisibility)) {&#10;                gg.corn.DunceChat.DunceChat.setDunceChatVisible(player, !gg.corn.DunceChat.DunceChat.dunceVisible(player));&#10;                DunceGUI.constructDunceGUI(player);&#10;                player.playSound(player.getLocation(), Sound.ENTITY_EXPERIENCE_ORB_PICKUP, 1.0f, 1.0f);&#10;            } else if (NBTHandler.hasString(item, talkingInDunceChat)) {&#10;                gg.corn.DunceChat.DunceChat.setInDunceChat(player, !gg.corn.DunceChat.DunceChat.getInDunceChat(player));&#10;                DunceGUI.constructDunceGUI(player);&#10;                player.playSound(player.getLocation(), Sound.ENTITY_EXPERIENCE_ORB_PICKUP, 1.0f, 1.0f);&#10;            }&#10;        }&#10;    }&#10;&#10;    @EventHandler&#10;    public void onPlayerCommandPreprocess(PlayerCommandPreprocessEvent event) {&#10;        // Check if the command is '/me'&#10;        if (event.getMessage().startsWith(&quot;/me&quot;)) {&#10;            // Check if the player is dunced&#10;            if (gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer())) {&#10;                // Cancel the command and possibly notify the player&#10;                event.setCancelled(true);&#10;                event.getPlayer().sendMessage(ChatColor.RED + &quot;You are dunced and cannot use this command.&quot;);&#10;            }&#10;        }&#10;    }&#10;&#10;&#10;    @EventHandler&#10;    public void playerJoin(@NotNull PlayerJoinEvent event) {&#10;        UserData.updateUser(event.getPlayer(), true, false);&#10;    }&#10;&#10;    @EventHandler&#10;    public void playerQuit(@NotNull PlayerQuitEvent event) {&#10;        UserData.updateUser(event.getPlayer(), false, true);&#10;    }&#10;&#10;    @EventHandler&#10;    public void playerTalk(@NotNull AsyncPlayerChatEvent event) {&#10;&#10;        Player player = event.getPlayer();&#10;        String playerName = getDisplayName(player);&#10;        String prefix = getPrefix(player);&#10;        String duncedPrefix = ChatColor.DARK_GRAY + &quot;[&quot; + ChatColor.GOLD+ plugin.getConfig().getString(&quot;dunced-prefix&quot;)+ ChatColor.DARK_GRAY + &quot;]&quot; + ChatColor.RESET;&#10;        String unmoderatedPrefix = ChatColor.DARK_GRAY + &quot;[&quot; + ChatColor.GOLD+ plugin.getConfig().getString(&quot;unmoderated-chat-prefix&quot;)+ ChatColor.DARK_GRAY + &quot;]&quot;+ ChatColor.RESET;&#10;&#10;        if (gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer())) {&#10;            event.getRecipients().retainAll(gg.corn.DunceChat.DunceChat.getPlayersDunceChatVisible());&#10;            event.setCancelled(true);&#10;&#10;            for (Player recipient : event.getRecipients())&#10;                recipient.sendMessage(&quot;&lt;&quot; +duncedPrefix+ prefix+ playerName+ ChatColor.RESET+ &quot;&gt;&quot; + &quot; &quot; + ChatColor.RESET + event.getMessage());&#10;            logger.info(&quot;&lt;&quot; +duncedPrefix+ prefix+ playerName+ ChatColor.RESET+ &quot;&gt;&quot; + &quot; &quot; + ChatColor.RESET + event.getMessage());&#10;        } else if (gg.corn.DunceChat.DunceChat.getInDunceChat(event.getPlayer())) {&#10;            Set&lt;Player&gt; set = Sets.newHashSet(event.getPlayer());&#10;            set.addAll(gg.corn.DunceChat.DunceChat.getPlayersDunceChatVisible());&#10;&#10;            event.getRecipients().retainAll(set);&#10;            event.setCancelled(true);&#10;&#10;            for (Player recipient : event.getRecipients())&#10;                recipient.sendMessage(&quot;&lt;&quot; + unmoderatedPrefix+ prefix+ playerName+ ChatColor.RESET+ &quot;&gt;&quot; + &quot; &quot; + ChatColor.RESET + event.getMessage());&#10;            logger.info(&quot;&lt;&quot; + unmoderatedPrefix+ prefix+ playerName+ ChatColor.RESET+ &quot;&gt;&quot; + &quot; &quot; + ChatColor.RESET + event.getMessage());&#10;        }&#10;&#10;        if (plugin.getConfig().getBoolean(&quot;dunceStar&quot;))&#10;            if (!gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer()) &amp;&amp; gg.corn.DunceChat.DunceChat.dunceVisible(event.getPlayer()))&#10;                event.setFormat(event.getFormat().replace(&quot;%1$s&quot;, &quot;%1$s&quot; + ChatColor.GREEN + &quot;*&quot; + ChatColor.RESET));&#10;&#10;    }&#10;&#10;    public String getDisplayName(Player player) {&#10;        String papiDisplayName = plugin.getConfig().getString(&quot;display-name-placeholder&quot;);&#10;        if (Bukkit.getPluginManager().getPlugin(&quot;PlaceholderAPI&quot;) != null) {&#10;            String placeholderName = PlaceholderAPI.setPlaceholders(player, papiDisplayName);&#10;            return ChatColor.translateAlternateColorCodes('&amp;', placeholderName);&#10;        } else {&#10;            return player.getName();&#10;        }&#10;    }&#10;    public String getPrefix(Player player) {&#10;        String papiPrefix = plugin.getConfig().getString(&quot;prefix-placeholder&quot;);&#10;        if (Bukkit.getPluginManager().getPlugin(&quot;PlaceholderAPI&quot;) != null) {&#10;            String placeholderName = PlaceholderAPI.setPlaceholders(player, papiPrefix);&#10;            return ChatColor.translateAlternateColorCodes('&amp;', placeholderName);&#10;        } else {&#10;            return null;&#10;        }&#10;    }&#10;&#10;    private void loadDisallowedWords() {&#10;        disallowedWords = plugin.getWordsConfig().getStringList(&quot;disallowed-words&quot;);&#10;    }&#10;&#10;    @EventHandler&#10;    public void onAsyncPlayerChat(AsyncPlayerChatEvent event) {&#10;        String message = event.getMessage().toLowerCase();&#10;&#10;        if (event.getPlayer().hasPermission(&quot;duncechat.admin&quot;)) {&#10;            // Player has the bypass permission, do not check for disallowed words&#10;            return;&#10;        }&#10;&#10;        if (gg.corn.DunceChat.DunceChat.getInDunceChat(event.getPlayer())){&#10;            //player is in unmoderated chat already&#10;            return;&#10;        }&#10;&#10;        for (String word : disallowedWords) {&#10;            if (message.contains(word.toLowerCase())) {&#10;                UUID uuid = event.getPlayer().getUniqueId();&#10;                String player = MySQLHandler.getNameByUUID(uuid);&#10;&#10;                if(!gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer())) {&#10;                    //gg.corn.DunceChat.DunceChat.setDunced(uuid, !DunceChat.isDunced(uuid), reason, new UUID(0,0), null);&#10;                    DunceChat.setDunced(uuid,true,&quot;AutoDunced&quot;,null,null);&#10;                    //DunceCommand.tryDunce(player,reason,Bukkit.getConsoleSender());&#10;                    //this is being stupid so i will directly manipulate the database here.&#10;                    MySQLHandler.setDunceReason(uuid, &quot;AutoDunced&quot;);&#10;                }&#10;&#10;                // You can optionally cancel the event to prevent the message from being sent&#10;                event.setCancelled(true);&#10;&#10;                // Notify the player or take other actions as needed&#10;                break;&#10;            }&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package gg.corn.DunceChat;&#10;&#10;import java.util.*;&#10;import java.util.logging.Logger;&#10;&#10;import com.google.common.collect.Lists;&#10;import com.google.common.collect.Sets;&#10;import org.apache.commons.lang3.StringUtils;&#10;import org.bukkit.Bukkit;&#10;import org.bukkit.NamespacedKey;&#10;import org.bukkit.Sound;&#10;&#10;import net.kyori.adventure.text.Component;&#10;import net.kyori.adventure.text.format.NamedTextColor;&#10;import net.kyori.adventure.text.format.TextColor;&#10;import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;&#10;&#10;import org.bukkit.entity.Player;&#10;import org.bukkit.event.EventHandler;&#10;import org.bukkit.event.Listener;&#10;import org.bukkit.event.inventory.InventoryClickEvent;&#10;import org.bukkit.event.player.AsyncPlayerChatEvent;&#10;import org.bukkit.event.player.PlayerCommandPreprocessEvent;&#10;import org.bukkit.event.player.PlayerJoinEvent;&#10;import org.bukkit.event.player.PlayerQuitEvent;&#10;import org.bukkit.inventory.ItemStack;&#10;import org.jetbrains.annotations.NotNull;&#10;import me.clip.placeholderapi.PlaceholderAPI;&#10;&#10;&#10;public class Events implements Listener {&#10;&#10;    private NBTHandler nbtHandler;&#10;    public static DunceChat plugin = gg.corn.DunceChat.DunceChat.getPlugin(DunceChat.class);&#10;    private static final Logger logger = Bukkit.getLogger();&#10;    public static MySQLHandler mySQLHandler;&#10;    private List&lt;String&gt; disallowedWords;&#10;    NamespacedKey dunceVisibility = new NamespacedKey(plugin, &quot;dunce-visibility&quot;);&#10;    NamespacedKey talkingInDunceChat = new NamespacedKey(plugin, &quot;talking-in-dunce-chat&quot;);&#10;    NamespacedKey page = new NamespacedKey(plugin, &quot;page&quot;);&#10;&#10;    public Events() {&#10;        loadDisallowedWords();&#10;    }&#10;&#10;&#10;    @EventHandler&#10;    public void processCommand(@NotNull PlayerCommandPreprocessEvent event) {&#10;        if (!event.getMessage().contains(&quot; &quot;) || !gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer()))&#10;            return;&#10;&#10;        List&lt;String&gt; list = Lists.newArrayList(&quot;whisper&quot;, &quot;w&quot;, &quot;msg&quot;, &quot;r&quot;, &quot;reply&quot;);&#10;        String message = event.getMessage();&#10;        String command = message.substring(1, message.contains(&quot; &quot;) ? message.indexOf(&quot; &quot;) : message.length())&#10;                .toLowerCase();&#10;        String recipient = message.substring(message.indexOf(&quot; &quot;) + 1, StringUtils.ordinalIndexOf(message, &quot; &quot;, 2) != -1&#10;                ? StringUtils.ordinalIndexOf(message, &quot; &quot;, 2) : message.length() - 1);&#10;        UUID uuid = mySQLHandler.getUUIDByName(recipient);&#10;&#10;        if (list.contains(command) &amp;&amp; uuid != null &amp;&amp; !gg.corn.DunceChat.DunceChat.dunceVisible(uuid)) {&#10;            event.getPlayer().sendMessage(gg.corn.DunceChat.DunceChat.baseColor()&#10;                    + &quot;You have been dunced, and the player you're trying to message has unmoderated chat disabled.&quot;);&#10;            event.setCancelled(true);&#10;        }&#10;    }&#10;&#10;    @EventHandler&#10;    public void clickDunceMenu(@NotNull InventoryClickEvent event) {&#10;&#10;        if (event.getView().getTitle().equals(&quot;DunceChat Menu&quot;) &amp;&amp; event.getView().getTopInventory().getHolder() == null) {&#10;            event.setCancelled(true);&#10;&#10;            if (event.getCurrentItem() == null)&#10;                return;&#10;&#10;            ItemStack item = event.getCurrentItem();&#10;            Player player = (Player) event.getWhoClicked();&#10;&#10;            if (NBTHandler.hasString(item, dunceVisibility)) {&#10;                gg.corn.DunceChat.DunceChat.setDunceChatVisible(player, !gg.corn.DunceChat.DunceChat.dunceVisible(player));&#10;                DunceGUI.constructDunceGUI(player);&#10;                player.playSound(player.getLocation(), Sound.ENTITY_EXPERIENCE_ORB_PICKUP, 1.0f, 1.0f);&#10;            } else if (NBTHandler.hasString(item, talkingInDunceChat)) {&#10;                gg.corn.DunceChat.DunceChat.setInDunceChat(player, !gg.corn.DunceChat.DunceChat.getInDunceChat(player));&#10;                DunceGUI.constructDunceGUI(player);&#10;                player.playSound(player.getLocation(), Sound.ENTITY_EXPERIENCE_ORB_PICKUP, 1.0f, 1.0f);&#10;            }&#10;        }&#10;    }&#10;&#10;    @EventHandler&#10;    public void onPlayerCommandPreprocess(PlayerCommandPreprocessEvent event) {&#10;        // Check if the command is '/me'&#10;        if (event.getMessage().startsWith(&quot;/me&quot;)) {&#10;            // Check if the player is dunced&#10;            if (gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer())) {&#10;                // Cancel the command and possibly notify the player&#10;                event.setCancelled(true);&#10;                event.getPlayer().sendMessage(Component.text(&quot;You are dunced and cannot use this command.&quot;, NamedTextColor.RED));&#10;            }&#10;        }&#10;    }&#10;&#10;&#10;    @EventHandler&#10;    public void playerJoin(@NotNull PlayerJoinEvent event) {&#10;        UserData.updateUser(event.getPlayer(), true, false);&#10;    }&#10;&#10;    @EventHandler&#10;    public void playerQuit(@NotNull PlayerQuitEvent event) {&#10;        UserData.updateUser(event.getPlayer(), false, true);&#10;    }&#10;&#10;    @EventHandler&#10;    public void playerTalk(@NotNull AsyncPlayerChatEvent event) {&#10;&#10;        Player player = event.getPlayer();&#10;        String playerName = getDisplayName(player);&#10;        String prefix = getPrefix(player);&#10;        String duncedPrefix = ChatColor.DARK_GRAY + &quot;[&quot; + ChatColor.GOLD+ plugin.getConfig().getString(&quot;dunced-prefix&quot;)+ ChatColor.DARK_GRAY + &quot;]&quot; + ChatColor.RESET;&#10;        String unmoderatedPrefix = ChatColor.DARK_GRAY + &quot;[&quot; + ChatColor.GOLD+ plugin.getConfig().getString(&quot;unmoderated-chat-prefix&quot;)+ ChatColor.DARK_GRAY + &quot;]&quot;+ ChatColor.RESET;&#10;&#10;        if (gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer())) {&#10;            event.getRecipients().retainAll(gg.corn.DunceChat.DunceChat.getPlayersDunceChatVisible());&#10;            event.setCancelled(true);&#10;&#10;            for (Player recipient : event.getRecipients())&#10;                recipient.sendMessage(&quot;&lt;&quot; +duncedPrefix+ prefix+ playerName+ ChatColor.RESET+ &quot;&gt;&quot; + &quot; &quot; + ChatColor.RESET + event.getMessage());&#10;            logger.info(&quot;&lt;&quot; +duncedPrefix+ prefix+ playerName+ ChatColor.RESET+ &quot;&gt;&quot; + &quot; &quot; + ChatColor.RESET + event.getMessage());&#10;        } else if (gg.corn.DunceChat.DunceChat.getInDunceChat(event.getPlayer())) {&#10;            Set&lt;Player&gt; set = Sets.newHashSet(event.getPlayer());&#10;            set.addAll(gg.corn.DunceChat.DunceChat.getPlayersDunceChatVisible());&#10;&#10;            event.getRecipients().retainAll(set);&#10;            event.setCancelled(true);&#10;&#10;            for (Player recipient : event.getRecipients())&#10;                recipient.sendMessage(&quot;&lt;&quot; + unmoderatedPrefix+ prefix+ playerName+ ChatColor.RESET+ &quot;&gt;&quot; + &quot; &quot; + ChatColor.RESET + event.getMessage());&#10;            logger.info(&quot;&lt;&quot; + unmoderatedPrefix+ prefix+ playerName+ ChatColor.RESET+ &quot;&gt;&quot; + &quot; &quot; + ChatColor.RESET + event.getMessage());&#10;        }&#10;&#10;        if (plugin.getConfig().getBoolean(&quot;dunceStar&quot;))&#10;            if (!gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer()) &amp;&amp; gg.corn.DunceChat.DunceChat.dunceVisible(event.getPlayer()))&#10;                event.setFormat(event.getFormat().replace(&quot;%1$s&quot;, &quot;%1$s&quot; + ChatColor.GREEN + &quot;*&quot; + ChatColor.RESET));&#10;&#10;    }&#10;&#10;    public String getDisplayName(Player player) {&#10;        String papiDisplayName = plugin.getConfig().getString(&quot;display-name-placeholder&quot;);&#10;        if (Bukkit.getPluginManager().getPlugin(&quot;PlaceholderAPI&quot;) != null) {&#10;            String placeholderName = PlaceholderAPI.setPlaceholders(player, papiDisplayName);&#10;            return ChatColor.translateAlternateColorCodes('&amp;', placeholderName);&#10;        } else {&#10;            return player.getName();&#10;        }&#10;    }&#10;    public String getPrefix(Player player) {&#10;        String papiPrefix = plugin.getConfig().getString(&quot;prefix-placeholder&quot;);&#10;        if (Bukkit.getPluginManager().getPlugin(&quot;PlaceholderAPI&quot;) != null) {&#10;            String placeholderName = PlaceholderAPI.setPlaceholders(player, papiPrefix);&#10;            return ChatColor.translateAlternateColorCodes('&amp;', placeholderName);&#10;        } else {&#10;            return null;&#10;        }&#10;    }&#10;&#10;    private void loadDisallowedWords() {&#10;        disallowedWords = plugin.getWordsConfig().getStringList(&quot;disallowed-words&quot;);&#10;    }&#10;&#10;    @EventHandler&#10;    public void onAsyncPlayerChat(AsyncPlayerChatEvent event) {&#10;        String message = event.getMessage().toLowerCase();&#10;&#10;        if (event.getPlayer().hasPermission(&quot;duncechat.admin&quot;)) {&#10;            // Player has the bypass permission, do not check for disallowed words&#10;            return;&#10;        }&#10;&#10;        if (gg.corn.DunceChat.DunceChat.getInDunceChat(event.getPlayer())){&#10;            //player is in unmoderated chat already&#10;            return;&#10;        }&#10;&#10;        for (String word : disallowedWords) {&#10;            if (message.contains(word.toLowerCase())) {&#10;                UUID uuid = event.getPlayer().getUniqueId();&#10;                String player = MySQLHandler.getNameByUUID(uuid);&#10;&#10;                if(!gg.corn.DunceChat.DunceChat.isDunced(event.getPlayer())) {&#10;                    //gg.corn.DunceChat.DunceChat.setDunced(uuid, !DunceChat.isDunced(uuid), reason, new UUID(0,0), null);&#10;                    DunceChat.setDunced(uuid,true,&quot;AutoDunced&quot;,null,null);&#10;                    //DunceCommand.tryDunce(player,reason,Bukkit.getConsoleSender());&#10;                    //this is being stupid so i will directly manipulate the database here.&#10;                    MySQLHandler.setDunceReason(uuid, &quot;AutoDunced&quot;);&#10;                }&#10;&#10;                // You can optionally cancel the event to prevent the message from being sent&#10;                event.setCancelled(true);&#10;&#10;                // Notify the player or take other actions as needed&#10;                break;&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>